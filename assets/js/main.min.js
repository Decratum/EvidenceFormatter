$("document").ready(function(){if(existing=localStorage.getItem("cite")){existing=JSON.parse(existing);for(var a in existing)$("#"+a).val(existing[a])}$.fn.amper=function(a){return a.replace(" and "," &amp; "),a},$.fn.getData=function(){cite=new Object,$(".data").each(function(){id=$(this).attr("id"),val=$.trim($(this).val()),toamp=["tag","author","authorc","pub","pubc"],-1!==jQuery.inArray(id,toamp)&&(val=$().amper(val)),cite[id]=val})},$(window).unload(function(){$().getData(),localStorage.setItem("cite",JSON.stringify(cite))}),$.fn.printData=function(a){var b=localStorage.getItem("format");if(b)var b=JSON.parse(b);else var b="decratum";switch($("input[value='"+b+"'][name='format']").attr("checked","true"),$.each(a,function(a,b){print[a]='<span class="item" contenteditable="true" id="'+a+'">'+b+"</span>"}),b){case"decratum":var c="<b>"+print.tag+"</b><br />",c=c+"<i>",c=c+print.author+" <del>("+print.authorc+")</del> ",c=c+print.pub+" <del>("+print.pubc+")</del> ",c=c+print.date,c=c+"<br />",c=c+"<u>"+print.url+"</u>",c=c+"</i>",c=c+"<br /><br />",c=c+"&#8220;"+print.quote+"&#8221;";break;case"bluebook":var c="<b>"+print.tag+"</b><br />",c=c+"<i>",c=c+"<u>"+print.author+"</u> ("+print.authorc+") ",c=c+"<u>"+print.pub+"</u> ("+print.pubc+") ",c=c+print.date+" ",c=c+"<u>"+print.url+"</u>",c=c+"</i>",c=c+"<br /><br />",c=c+"&#8220;"+print.quote+"&#8221;";break;case"source":var c="<b>"+print.tag+"</b><br />",c=c+"<i>",c=c+'<span class="source">'+print.author+"</span> <small>("+print.authorc+")</small> ",c=c+'<span class="source">'+print.pub+"</span> <small>("+print.pubc+")</small> ",c=c+'<span class="source">'+print.date+"</span><br />",c=c+"<u>"+print.url+"</u>",c=c+"</i>",c=c+"<br /><br />",c=c+"&#8220;"+print.quote+"&#8221;";break;case"cog":break;case"ethos":}var c=c.replace(/ \'/g," &#8216;"),c=c.replace(/\' /g,"&#8217; "),c=c.replace(/\'/g,"&#8217;"),c=c.replace(".)g",")"),c=c.replace("<del>()</del>",""),d=$("#cards .card:first-child").attr("id");if(d)var e=d.split("-"),f=e[1],f=++f;else var f="1";var d=f;cards=localStorage.getItem("cards"),cards=cards?JSON.parse(cards):new Object,cards[d]=a,localStorage.setItem("cards",JSON.stringify(cards)),$("div#cards").prepend('<span class="card" id="num-'+d+'"><br /><br />'+c+"</span>")},$("button#format").click(function(){$().getData(),$().printData(cite)}),$.fn.printExisting=function(){$("#cards").html(""),existingCards=localStorage.getItem("cards"),existingCards&&(existingCards=JSON.parse(existingCards),$.each(existingCards,function(a,b){$().printData(b)}))},$().printExisting(),$(".item").live("keydown blur",function(a){var b=$(this).attr("id");cards=localStorage.getItem("cards"),cards=JSON.parse(cards);var c=$(this).closest(".card").attr("id").split("-"),c=c[1];cards[c][b]=$(this).html(),localStorage.setItem("cards",JSON.stringify(cards)),13==a.keyCode&&a.preventDefault()}),$("input[name='format']").click(function(){var a=$(this).val();localStorage.setItem("format",JSON.stringify(a)),$().printExisting()}),$("button#clearf").click(function(){$("div#formatter :input").val("")}),$("button#clearc").click(function(){var a=confirm("Are you sure you want to clear your evidence?");a&&(localStorage.removeItem("cards"),$().printExisting())})});